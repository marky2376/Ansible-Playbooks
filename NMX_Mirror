--- 
- name: "Provision Port Mirror"
  connection: network_cli
  gather_facts: false
  hosts: Chester_HE_Nexus Pod_1
    
  vars: 
    preview: "{{ PREVIEW }}"
    port_descriptions "{{ PORT_DESC }}"
    switch: "{{ SWITCH }}"
    monitor: "{{ MONITOR }}" 
    interface: "{{ INTERFACE }}"
    
  tasks:
  
    - name: Show current monitor sessions
      nxos_command:
        commands:
          - command: show running-config monitor all
      when: (port_descriptions == "yes")
  
    - name: Show Port Descriptions
      nxos_command:
        commands:
          - command: show int status
      when: (preview == "yes")
      
    - name: Build Monitor Session
      nxos_config:
        lines:
        - description Harmonic NMX {" monitor "}
        - source interface {" interface "}
        - 30 permit ip 3.3.3.3/32 any log
        - 40 permit ip 4.4.4.4/32 any log
        parents: ip access-list test
        before: no ip access-list test
        replace: block
      delegate_to:
      when: switch is Nexus 1
