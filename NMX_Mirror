--- 
- name: "Provision Switches"
  connection: network_cli
  gather_facts: false
  hosts: Chester_HE_Nexus Pod_1
    
  vars: 
    preview: "{{ PREVIEW }}"
    port_descriptions "{{ PORT_DESC }}"
    switch: "{{ SWITCH }}"
    monitor: "{{ MONITOR }}"
    interface_des: "{{ DESCRIPTION }}"
    vlans: "{{ VLANS }}"
    y: "{{ '8' if switch_group == 'Chester_CO_POD2' else '6' }}"
    
  tasks:
  
    - name: Show current monitor sessions
      nxos_command:
        commands:
          - command: show running-config monitor all
      when: (port_descriptions == "yes")
  
    - name: Show Port Descriptions
      nxos_command:
        commands:
          - command: show int status
      when: (preview == "yes")
      
    - name: Build Monitor Session
      nxos_config:
        lines:
        - 10 permit ip 1.1.1.1/32 any log
        - 20 permit ip 2.2.2.2/32 any log
        - 30 permit ip 3.3.3.3/32 any log
        - 40 permit ip 4.4.4.4/32 any log
        parents: ip access-list test
        before: no ip access-list test
        replace: block
      delegate_to:
